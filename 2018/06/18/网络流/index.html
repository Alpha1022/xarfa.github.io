<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="ARFA">
  <!-- Open Graph Data -->
  <meta property="og:title" content="网络流"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="ARFA"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://yoursite.com"/>
  
    <link rel="alternate" href="/atom.xml" title="ARFA" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>ARFA</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.dark.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">网络流</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/xarfa">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="https://www.luogu.org/space/show?uid=77760">
                  
                  Luogu
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By ARFA</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2018-06-18</span>
            <span class="time">19:36:32</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/图论/">图论</a>
</span>
          
        </div>
        <!-- Tags -->
        
        <!-- Post Main Content -->
        <div class="post-content">
          <p>源码:</p>
<h1 id="Network-flows-by-pascal"><a href="#Network-flows-by-pascal" class="headerlink" title="Network-flows by pascal"></a>Network-flows by pascal</h1><h2 id="最容易懂的属于你的网络流…"><a href="#最容易懂的属于你的网络流…" class="headerlink" title="最容易懂的属于你的网络流…"></a>最容易懂的属于你的网络流…</h2><a id="more"></a>
<h2 id="What-is-“Network-flows”"><a href="#What-is-“Network-flows”" class="headerlink" title="What is “Network-flows”?"></a>What is “Network-flows”?</h2><p>网络流的定义?肯定很多人士看了第一眼,就会觉得:<br><strong>什么鬼呀！</strong></p>
<p><img src="https://cdn.luogu.org/upload/pic/2262.png" alt=""><br><strong>假设这张图</strong></p>
<p>我有无数个汽车,我要从4点到3点,并且每一条路的<strong>流量</strong>(相当于边权吧)是它可以的通车数量。</p>
<p>并且通过了一定车就只能通<strong>流量减去通车量</strong>那么多的车了(例子:4到3有20辆车通过后,那么这条路同等于封死了,如果只是通过10辆,那么<strong>还有10辆车</strong>可以通过)</p>
<p>那么,请求出我有多少辆车可以过去?</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">聪明的你选择了如下方案:</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>. <span class="number">4</span>-&gt;<span class="number">3</span>,<span class="number">20</span>辆车</span><br><span class="line"><span class="number">2</span>. <span class="number">4</span>-&gt;<span class="number">2</span>-&gt;<span class="number">3</span>,<span class="number">20</span>辆车 (为什么,<span class="number">4</span>-&gt;<span class="number">2</span>不是<span class="number">30</span>辆吗? 拜托,你到<span class="number">2</span>-&gt;<span class="number">3</span>的时候就只有<span class="number">20</span>辆车了) (注意,此时的<span class="number">4</span>-&gt;<span class="number">2</span>只有<span class="number">10</span>流量了)</span><br><span class="line"><span class="number">3</span>. <span class="number">4</span>-&gt;<span class="number">2</span>-&gt;<span class="number">1</span>-&gt;<span class="number">3</span>,<span class="number">10</span>辆车 (又为什么? 拜托,<span class="number">4</span>-&gt;<span class="number">2</span>只有<span class="number">10</span>啦!)</span><br></pre></td></tr></table></figure>
<p>把我们的方案变成图:</p>
<p><img src="https://cdn.luogu.org/upload/pic/20432.png" alt=""></p>
<p>我告诉你,<strong>红色的边代表我们选的边</strong>,灰色暂时不用管,flow是我们的<strong>流量总值</strong>(就是答案啦)。</p>
<p>这就是:神奇的网络流</p>
<hr>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>我们介绍EK和Dinic算法。</p>
<p>首先,我们了解什么叫做<strong>增广路</strong>。</p>
<h3 id="增广路"><a href="#增广路" class="headerlink" title="增广路"></a>增广路</h3><p>在众多种方案中(路线),我们对可行的路线(也就是&gt;0)进行增广。</p>
<p>如图:<br><img src="https://cdn.luogu.org/upload/pic/20459.png" alt=""><br>这就是增广。</p>
<p>你会想,这不是简单吗,我们一个一个回溯,跑big法师或者大法师不就行了?(Dfs,Bfs)</p>
<p>我们会出现一种很<strong>坑</strong>的情况。<br>如图:</p>
<p><img src="https://cdn.luogu.org/upload/pic/20460.png" alt=""></p>
<p>太棒了!</p>
<h3 id="反向边"><a href="#反向边" class="headerlink" title="反向边"></a>反向边</h3><p>这就是这个算法的精华部分，利用反向边，使程序有了一个<strong>后悔和改正</strong>的机会。</p>
<p>盗了图:<br><img src="https://cdn.luogu.org/upload/pic/20473.png" alt=""></p>
<p>反向边这个东西想深刻理解很难,按照我的理解方式:<br><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">反正被选过了,反向没有什么关系,还能有反悔机会,而且是流量,又不是什么最短路径,而且能AC,真是太棒了...</span><br><span class="line">(真是蒟蒻了)</span><br></pre></td></tr></table></figure></p>
<p>当此边被选的时候,建立反向边,直接把反向边增加为<strong>流走流量</strong>就可以了(table[A][B]减去<strong>流走流量</strong>,table[B][A]增加<strong>流走流量</strong>)</p>
<p>我们的两个算法:EK和Dinic都是依靠增广路和反向边的性质来做的呢。</p>
<hr>
<h2 id="EK-Edmonds-Karp"><a href="#EK-Edmonds-Karp" class="headerlink" title="EK (Edmonds_Karp)"></a>EK (Edmonds_Karp)</h2><p>建议先抄标,再理解。</p>
<figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">步骤:</span><br><span class="line"><span class="number">1</span>.从source(源点)出发,用BFS那找出 [ 一条 ] 增广路。(退出BFS)</span><br><span class="line"><span class="number">2</span>.将这些增广路增广并建造反向边。</span><br><span class="line"><span class="number">3</span>.重复source,直到没有增广路找得到。</span><br></pre></td></tr></table></figure>
<h4 id="CODE"><a href="#CODE" class="headerlink" title="CODE"></a>CODE</h4><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 邻接表RE,70分</span></span><br><span class="line"><span class="keyword">Uses</span> math;<span class="comment">//神奇数学</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        sink,source,n,m,i,x,y,sum,ans:longint;<span class="comment">//sink=汇点,source=源点</span></span><br><span class="line">        table:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">3000</span>,<span class="number">1</span>..<span class="number">3000</span>] <span class="keyword">of</span> longint;</span><br><span class="line">        last,flow:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>] <span class="keyword">of</span> longint;<span class="comment">//我们是找到一条增广路才进行增广和反向边,所以要last记录前继点,也就是 什么点到了i这个点=last[i]。flow用来记录到某个点的最大flow值</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Function</span> <span class="title">Bfs</span>:</span>longint;<span class="comment">//Bfs部分</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        head,tail,i,k:longint;</span><br><span class="line">        will:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>] <span class="keyword">of</span> longint;<span class="comment">//队列</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">                last[i]:=-<span class="number">1</span>;</span><br><span class="line">        last[source]:=<span class="number">0</span>;<span class="comment">//这个应该懂</span></span><br><span class="line"></span><br><span class="line">        head:=<span class="number">1</span>;</span><br><span class="line">        tail:=<span class="number">1</span>;</span><br><span class="line">        will[<span class="number">1</span>]:=source;</span><br><span class="line">        flow[source]:=maxlongint;<span class="comment">//这个也是</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> head&lt;=tail <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                k:=will[head];</span><br><span class="line">                inc(head);</span><br><span class="line">                <span class="keyword">if</span> k=sink <span class="keyword">then</span><span class="comment">//到达汇点,立马结束!</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">                        <span class="keyword">if</span> (table[k,i]&gt;<span class="number">0</span>)<span class="keyword">and</span>(last[i]=-<span class="number">1</span>) <span class="keyword">then</span><span class="comment">//找到新点</span></span><br><span class="line">                        <span class="keyword">begin</span></span><br><span class="line">                                last[i]:=k;</span><br><span class="line">                                flow[i]:=min(table[k,i],flow[k]);</span><br><span class="line"></span><br><span class="line">                                inc(tail);</span><br><span class="line">                                will[tail]:=i;</span><br><span class="line">                        <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> last[sink]=-<span class="number">1</span> <span class="keyword">then</span><span class="comment">//找不到??</span></span><br><span class="line">                <span class="keyword">exit</span>(-<span class="number">1</span>);</span><br><span class="line">        Bfs:=flow[sink];<span class="comment">//这一条路径的flow</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">Procedure</span> <span class="title">Edmonds_Karp</span>;</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        increase,k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        increase:=Bfs;</span><br><span class="line">        <span class="keyword">while</span> increase&lt;&gt;-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                k:=sink;</span><br><span class="line">                <span class="keyword">while</span> k&lt;&gt;source <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                        dec(table[last[k],k],increase);<span class="comment">//减少正向边</span></span><br><span class="line">                        inc(table[k,last[k]],increase);<span class="comment">//增加反向边(建造)</span></span><br><span class="line">                        k:=last[k];<span class="comment">//继续</span></span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">                inc(ans,increase);<span class="comment">//增加答案</span></span><br><span class="line">                increase:=Bfs;<span class="comment">//increase用来存储这条边的最大流量</span></span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">read</span>(m,n,source,sink); <span class="comment">//主程序才是一个程序最难理解的地方!</span></span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">read</span>(x,y,sum);</span><br><span class="line">                inc(table[x,y],sum); <span class="comment">//必须inc!!</span></span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        Edmonds_Karp;</span><br><span class="line">        writeln(ans);<span class="comment">//才怪</span></span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h2><p>我们想,能不能改进EK,少做一点BFS??? (我说:不行!EK万岁!)</p>
<p>那你就[踏]错特错了。</p>
<p>Dinic引入分层图思想,也就是说,这个点离源点多长(经过多少个边),那它就被分在第<strong>与源点的距离+1</strong>层,在程序中,相同的层不能<strong>增广(选择)</strong>!<br><img src="https://cdn.luogu.org/upload/pic/20465.png" alt=""></p>
<p>用什么分层?BFS!!</p>
<p>Dinic还有一个好地方,就是一次不止找一个增广路!!!<br>我们用到DFS!!!</p>
<p><img src="https://cdn.luogu.org/upload/pic/20471.png" alt=""></p>
<p>我们每一次循环先<strong>分层</strong>,再<strong>Dfs找增广路</strong>。</p>
<p>拓展:当前弧优化(可以自行查找博客)。</p>
<h4 id="CODE-1"><a href="#CODE-1" class="headerlink" title="CODE"></a>CODE</h4><figure class="highlight pascal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Uses</span> math;<span class="comment">//神奇的数学</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        next,reach,value,cnt:<span class="keyword">array</span>[-<span class="number">1</span>..<span class="number">200000</span>] <span class="keyword">of</span> longint; <span class="comment">//这次我用到了链式前向星,不会的请认真学习 </span></span><br><span class="line">        dep:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200000</span>] <span class="keyword">of</span> longint;<span class="comment">//分层,深度</span></span><br><span class="line">        will:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">200000</span>] <span class="keyword">of</span> longint;<span class="comment">//队列</span></span><br><span class="line">        cur:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">200000</span>] <span class="keyword">of</span> longint;<span class="comment">//当前弧优化</span></span><br><span class="line">        n,m,sink,source,i,x,y,sum,tot,maxflow:longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(x,y:longint)</span>;</span><span class="comment">//链式前向星</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        inc(tot);</span><br><span class="line">        reach[tot]:=y;</span><br><span class="line">        value[tot]:=sum;</span><br><span class="line">        next[tot]:=cnt[x];</span><br><span class="line">        cnt[x]:=tot;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bfs</span>:</span>boolean;<span class="comment">//分层</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        head,tail,now,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        fillchar(dep,sizeof(dep),<span class="number">0</span>);<span class="comment">//清空为0</span></span><br><span class="line">        dep[source]:=<span class="number">1</span>;</span><br><span class="line">        head:=<span class="number">1</span>;</span><br><span class="line">        tail:=<span class="number">1</span>;</span><br><span class="line">        will[<span class="number">1</span>]:=source;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> head&lt;=tail <span class="keyword">do</span><span class="comment">//Bfs队列开始</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                now:=will[head];</span><br><span class="line">                inc(head);</span><br><span class="line">                i:=cnt[now];</span><br><span class="line">                <span class="keyword">while</span> i&lt;&gt;-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                        <span class="keyword">if</span> (value[i]&gt;<span class="number">0</span>)<span class="keyword">and</span>(dep[reach[i]]=<span class="number">0</span>) <span class="keyword">then</span><span class="comment">//没有被赋值Dep</span></span><br><span class="line">                        <span class="keyword">begin</span></span><br><span class="line">                                dep[reach[i]]:=dep[now]+<span class="number">1</span>;<span class="comment">//You know</span></span><br><span class="line">                                inc(tail);</span><br><span class="line">                                will[tail]:=reach[i];</span><br><span class="line">                        <span class="keyword">end</span>;</span><br><span class="line">                        i:=next[i];</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dep[sink]=<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">exit</span>(False);<span class="comment">//不能分层,汇点没有被赋值</span></span><br><span class="line">        Bfs:=True;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dfs</span><span class="params">(now,now_flow:longint)</span>:</span>longint;<span class="comment">//now为现在点,now_flow为现在的流量(最优)</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        flow,i,flow_,now_flow_:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        flow:=<span class="number">0</span>;</span><br><span class="line">        flow_:=<span class="number">0</span>;</span><br><span class="line">        now_flow_:=now_flow;</span><br><span class="line">        <span class="keyword">if</span> now=sink <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">exit</span>(now_flow);</span><br><span class="line"></span><br><span class="line">        i:=cur[now];</span><br><span class="line">        <span class="keyword">while</span> i&lt;&gt;-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (dep[reach[i]]=dep[now]+<span class="number">1</span>)<span class="keyword">and</span>(value[i]&gt;<span class="number">0</span>) <span class="keyword">then</span><span class="comment">//我说过了,必须同一层! 而且要有连边才行value[i]&gt;0</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                        flow:=Dfs(reach[i],min(now_flow_,value[i]));<span class="comment">//神奇的大法师?</span></span><br><span class="line">                        <span class="keyword">if</span> flow&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">begin</span></span><br><span class="line">                                dec(value[i],flow);</span><br><span class="line">                                inc(value[i xor <span class="number">1</span>],flow);</span><br><span class="line">                                inc(flow_,flow);<span class="comment">//对比EK优化之处</span></span><br><span class="line">                                dec(now_flow_,flow);<span class="comment">//对比EK优化之处</span></span><br><span class="line">                                <span class="keyword">if</span> now_flow_=<span class="number">0</span> <span class="keyword">then</span><span class="comment">//同上</span></span><br><span class="line">                                        <span class="keyword">break</span>; </span><br><span class="line">                        <span class="keyword">end</span>;</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">                i:=next[i];</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">exit</span>(flow_);<span class="comment">//加上本边后最优的流量</span></span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Dinic</span>;</span></span><br><span class="line"><span class="keyword">var</span></span><br><span class="line">        tmp,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> Bfs <span class="keyword">do</span><span class="comment">//如果还能分层(增广)</span></span><br><span class="line">            <span class="keyword">while</span> <span class="number">1</span>&lt;<span class="number">2</span> <span class="keyword">do</span><span class="comment">//大佬式优化</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">                            cur[i]:=cnt[i];<span class="comment">//当前弧优化</span></span><br><span class="line">                    tmp:=dfs(source,maxlongint);<span class="comment">//这一次整个图增广的流量</span></span><br><span class="line">                    <span class="keyword">if</span> tmp=<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                    inc(maxflow,tmp);<span class="comment">//answer</span></span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">Read_</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">read</span>(n,m,source,sink);</span><br><span class="line">        filldword(cnt,sizeof(cnt) <span class="keyword">div</span> <span class="number">4</span>,maxlongint*<span class="number">2</span>+<span class="number">1</span>);<span class="comment">//清空数组filldword(数组名字,sizeof(数组名字) div 4,maxlongint*2+1);=变为-1</span></span><br><span class="line">        filldword(next,sizeof(next) <span class="keyword">div</span> <span class="number">4</span>,maxlongint*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">read</span>(x,y,sum);<span class="comment">//链式前向星</span></span><br><span class="line">                add(x,y);</span><br><span class="line">                dec(sum,sum);</span><br><span class="line">                add(y,x);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">        tot:=<span class="number">1</span>; <span class="comment">//必须必须必须必须,以正式的惨案告诉你们:极限数据AC,普通数据WA</span></span><br><span class="line">        read_;<span class="comment">//输入</span></span><br><span class="line">        Dinic;</span><br><span class="line">        writeln(maxflow);<span class="comment">//answer</span></span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="为了伟大的OI事业"><a href="#为了伟大的OI事业" class="headerlink" title="为了伟大的OI事业!!"></a>为了伟大的OI事业!!</h3>
        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

